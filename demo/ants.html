
<script>

// Time when the animation began.
var start = null;
var lastFrame = null;

// List of points to draw, generated by mouse clicks.
// https://www.w3schools.com/js/js_arrays.asp
var ant = { 'x':0, 'y': 0 };
var crumbs = [];

var entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;',
  '`': '&#x60;',
  '=': '&#x3D;'
};

function escapeHtml (string) {
  return String(string).replace(/[&<>"'`=\/]/g, function (s) {
    return entityMap[s];
  });
}

function debug(str) {
  document.getElementById("debug").innerHTML += "<div>" + escapeHtml(str) + "</div>\n";
}

function draw() {
	var canvas = document.getElementById('canvas');

	if (canvas.getContext) {
	  var ctx = canvas.getContext('2d');

	  ctx.fillStyle = "#FF0000";
	  ctx.fillRect(0,0,150,75);
	}	
}

function getDrawingStuff() {
	var canvas = document.getElementById('canvas');
	var ctx = null;
	if (canvas.getContext) {
	  ctx = canvas.getContext('2d');
	  return {
		'canvas': canvas,
		'context': ctx
	  }; 
	}
	return null;
}

function copyArray(array) {
	var result = [];
	for (var k=0; k<array.length; k++) {
		result.push(array[k]);
	}
}

function range(n) {
	var result = [];
	for (var k=0; k < n; k++) {
		result.push(k);
	}
	return result;
}

function map(func, list) {
	var result = [];
	for (var k=0; k<list.length; k++) {
		result.push(func(list[k]));
	}	
	return result;
}

function forEach(list, func) {
	for (var k=0; k<list.length; k++) {
		func(list[k], k);
	}
}

function forMinimum(list, func) {
	if (list) {
		var min = null;
		var argmin = null;

		for (var k=0; k<list.length; k++) {
			if (min == null || list[k] < min) {
				min = list[k];
				argmin = k;
			}
		}
		
		if (min != null) func(min, argmin);		
	}
}

function norm2(vec) {
	return Math.sqrt(vec.x*vec.x+vec.y*vec.y);	
}

function diff(vec2, vec1) {
	return { 'x': vec2.x - vec1.x, 'y': vec2.y - vec1.y };
}

function distance(p1, p2) {
	return norm2(diff(p2,p1));
}

function unit(vec) {
	var mag = norm2(vec);
	if (mag > 0) {
		return {'x': vec.x/mag, 'y': vec.y/mag}
	}
}

function moveToward(p1, p2, dist) {
	var totalDistance = distance(p1, p2);
	if (totalDistance < dist) {
		return { 'x': p2.x, 'y': p2.y };
	}

	var normVec = unit(diff(p2, p1));
	return {
		'x': p1.x + dist * normVec.x,
		'y': p1.y + dist * normVec.y
	};
}

function drawDot(ctx, centerX, centerY, radius) {
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
  ctx.fillStyle = 'green';
  ctx.fill();
  ctx.lineWidth = 5;
  ctx.strokeStyle = '#003300';
  ctx.stroke();
}

function describePoint(point) {
	return '(' + point.x + ', ' + point.y + ')';
}

function describePointList(pointList) {
	var str = '[';
	for (var k=0; k<pointList.length; k++) {
		str += describePoint(pointList[k]) + ', ';
	}
	str += ']';
	return str;
}

function antStep(dist) {
  var distanceToCrumbs = map(function(c) {
  	return distance(ant, c);
  }, crumbs);

  forMinimum(distanceToCrumbs, function(distToCrumb, crumbIdx) {
  	var crumb = crumbs[crumbIdx];
	ant = moveToward(ant, crumb, dist);

	if (distance(ant, crumb) < 1.0) crumbs.splice(crumbIdx, 1);
  });	
}

function step(ts) {
  var drawing_stuff = getDrawingStuff();
  var canvas = drawing_stuff.canvas;
  var ctx = drawing_stuff.context;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!start) {
  	start = ts;
  	lastFrame = ts;
  }

  var progress = ts - start; 
  var elapsed = ts - lastFrame;
  //debug(elapsed);

  // Move the ant toward closest crumb.
  var antDistance = elapsed / 5.0;
  antStep(antDistance);

  if (false) {
	  var centerX = canvas.width / 2;
	  var centerY = canvas.height / 2;
	  var theta = progress / 1000.0;
	  var radius = 30 + 20 * Math.sin(2 * Math.PI * theta);
	  drawDot(ctx, centerX, centerY, radius);
  }

  else {
  	//debug(describePointList(points));
  	//debug(points.length);

  	// draw the ants
  	var antSize = 4;
  	var crumbSize = 10;

  	drawDot(ctx, ant.x, ant.y, antSize);

  	// draw the crumbs
  	var points = crumbs;
  	for (var k=0; k<points.length; k++) {

  		drawDot(ctx, points[k].x, points[k].y, crumbSize);
  	}
  }

  lastFrame = ts;
  window.requestAnimationFrame(step);
}

function startAnimation() {
	window.requestAnimationFrame(step);
}

function clickCanvas(event) {
	//debug(event);
	//listOfClicks.push(event);
	var obj = getDrawingStuff();
	getCursorPosition(obj.canvas, event);
}

function getCursorPosition(canvas, event) {
    var rect = canvas.getBoundingClientRect();

    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    var status = "x: " + x + " y: " + y;
    crumbs.push({ 'x': x, 'y': y });
}

window.onload = function() {
	// Register a handler for clicks on the canvas.
	document.getElementById('canvas').addEventListener('click', clickCanvas);

	startAnimation()
}

//var listOfClicks = [];

</script>

<table border="1"><tr><td>
<canvas id="canvas" width="600" height="400"></canvas>	
</td></tr></table>

<div id="debug">
</div>

<div id="status">
</div>
